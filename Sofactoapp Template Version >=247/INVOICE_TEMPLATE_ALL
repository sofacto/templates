<!--READ ME Voici l'article de notre base de connaissance : https://sofacto.force.com/support/s/article/catalogue-modele-pdf-facture-all-inclusive-portrait-mise-en-place?language=fr-->

<apex:page standardController="sofactoapp__Factures_Client__c"
    extensions="sofactoapp.FactureProcessingControllerExtension" renderAs="pdf" showHeader="false" sidebar="false" standardStylesheets="false"
    language="{!sofactoapp__Factures_Client__c.sofactoapp__Langue__c}" >

    <div id="wrap" style="position:relative;">
       

        <!-- Header -->
     
            <apex:stylesheet value="{!URLFOR($Resource.sofactoapp__INVOICE_STYLE)}" />

            <!-- Pied de page/ Footer -->
            <apex:outputPanel style="position: fixed;bottom: 0;font-size:9px" layout="block"  >
                <table class="aligncenter">
                    <tr style="font-family:Helvetica, sans-serif">
                        <!--Coordonnées de votre entreprise/ Your company's adress-->
                        <td style="width:30%">
                            <apex:outputPanel >
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.Name}"
                                    style="text-transform: uppercase; color:#696969; font-size:10px" />
                                <br /><apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Rue__c}" />
                                <br /><apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Code_postal__c}" />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Ville__c}" />
                                <br /><apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Pays__c}" />
                            </apex:outputPanel>
                        </td>

                        <!--Contact de votre entreprise/ Your companies contact infos-->
                        <td class="borderOn" style="border-left: 0.2px solid black; border-right: 0.2px solid black; border-top:hidden;border-bottom:hidden; width:30%">
                            <apex:outputPanel >
                                <apex:outputText value="T : {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__T_l_phone__c}"
                                    rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__T_l_phone__c))}" />
                                <br />
                                <apex:outputText value="F : {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__T_l_copie__c}"
                                    rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__T_l_copie__c))}" />
                                <br />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Email__c}" />
                                <br />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__website__c}" />
                            </apex:outputPanel>
                        </td>

                        <!--Mentions légales/ Legal notice-->
                        <td class="borderOn" style="border-left: hidden; border-right: 0.2px solid black; border-top:hidden;border-bottom:hidden; width:30%">
                            <apex:outputPanel >
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Forme_juridique__c} 
                                    {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Capital_social__c} 
                                    {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Ville_RCS__c}" />
                                <br />
                                <apex:outputText value="{!$ObjectType.sofactoapp__Raison_Sociale__c.Fields.sofactoapp__SIREN__c.Label} : 
                                    {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__SIREN__c}" />
                                <br />
                                <apex:outputText value="{!$ObjectType.sofactoapp__Raison_Sociale__c.Fields.sofactoapp__APE__c.Label} : 
                                    {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__APE__c}" />
                                <br />
                                <apex:outputText value="{!$ObjectType.sofactoapp__Raison_Sociale__c.Fields.sofactoapp__TVA_intra__c.Label} : 
                                    {!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__TVA_intra__c}" />
                            </apex:outputPanel>
                        </td>
                        <td style="width:10%" class="alignright">
                            <apex:outputText value="{!$Label.Sofacto_Page}" />&nbsp; <span class="pagenumber" />/ <span class="pagecount" />   
                        </td>
                    </tr>
                </table>
            </apex:outputPanel>



            <!-- Structure principale/ Main Structure -->

            
                <table>
                    <tr>
                        <td class="col33"></td>
                        <td class="col33"></td>
                        <td class="col33"></td>
                    </tr>

                    <!-- Référence de la Facture - Logo/ Invoice Number - Logo -->
                    <tr>
                        <td class="alignleft" style="width:60%">

                                
                        </td>
                        <td style="width:40%">
                        
                            <!--Type de la facture/ Invoice type -->
                            <apex:outputPanel style="text-transform: uppercase; color:#696969; font-size:25px">
                                <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Type_de_facture__c}" />&nbsp;
                            </apex:outputPanel>

                            <!--Mention Proforma -->
                            <br/>
                            <apex:outputText value="{!$Label.Sofacto_Proforma}" style="text-transform: uppercase; color:color:#696969;font-size:20px" 
                            rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c == false && 
                                NOT(ISBLANK($CurrentPage.parameters.proforma))}" />

                            <!--Référence de la facture (émise)/ (Issued) Invoice reference -->
                            <apex:outputPanel rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c}"> 
                                <apex:outputText style="font-size:20px; color:#696969" value=" N° {!sofactoapp__Factures_Client__c.sofactoapp__Reference__c}"/>
                                <br/>
                            </apex:outputPanel>

                            <!--Nom de la facture (brouillon)/ (Draft) Invoice name -->
                            <apex:outputPanel rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c == false}">
                                <apex:outputText style="font-size:25px; color:#696969" value=" N° {!sofactoapp__Factures_Client__c.Name}"/>
                                <br/>
                            </apex:outputPanel>

                            <!--Sous-type Avoir/ Credit Note Subtype-->
                            <apex:outputPanel rendered="{!IF(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c)),'','none')}">
                                <br />
                                <i>
                                    <apex:outputText style="font-size:13px"
                                        value="{!sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c}"
                                        rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c))}" />
                                </i>
                            </apex:outputPanel>
                                      
                        </td>
                    </tr>
                    <tr>
                        
                         <td  valign="top" class="alignleft" style="width:60%">

                            <!--Logo-->

                            <apex:image id="logo"
                                value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c}"
                                styleClass="logo" alt="Logo"
                                rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c))}"
                                style="float: left; height: 150px  " />

                            <!-- Si pas de logo, garder l'espace pour présentation de page / If no logo, holding the space for page layout-->
                            <apex:outputPanel rendered="{!ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c)}">
                                <div style="height: 150px;width: 300px; background-color: transparent">&nbsp;</div>
                            </apex:outputPanel>                  
                        </td>
                        

                        <!--Adresse de facturation/ Billing address-->

                        <td class="alignleft borderoff"
                            style="border-left: hidden; width:40%; display:{!IF(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Compte__r.ShippingStreet)), '', 'none')}">
                            
                            <br/><br/><br/><br/>
                            
                            <apex:outputText style="text-transform: uppercase; font-size:7px; text-decoration: underline" value="{!$Label.Sofacto_Adresse1}" /><br /><br />
                            
                            <apex:outputText style="text-transform: uppercase; color:#696969; font-size:15px" value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.Name}" />
                            <br />
                            <apex:outputPanel layout="none" rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Contact__c))}">
                                <i>
                                    <apex:outputText value="{!$Label.Sofacto_Adresse2}" />&nbsp;
                                    <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Contact__r.FirstName} {!sofactoapp__Factures_Client__c.sofactoapp__Contact__r.LastName}" />
                                </i>
                            </apex:outputPanel>
                            <br /><br />
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.BillingStreet}" />
                            <br />
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.BillingPostalCode}" />&nbsp;
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.BillingCity}" />
                            <br />
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.BillingCountry}" />
                            <br />
                            <br />
                            <br />
                        </td>
                    </tr>
                    <tr>
                        <td style="width:60%" valign="top">
                            <br/><br/>
                            <!--Date de la facture/ Invoice Date -->
                            <apex:outputPanel rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c}">
                                <apex:outputText value="{!$Label.Sofacto_DateEmission}" />&nbsp;
                                <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                    <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_de_facture__c}" />
                                </apex:outputText>
                            </apex:outputPanel>

                            <!--Date de livraison/ Shipping Date -->

                            <apex:outputPanel rendered="{!IF(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Date_de_livraison__c)),'','none')}">
                                <apex:outputText value="{!$Label.Sofacto_DateLivraison}" />&nbsp;
                                <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                    <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_de_livraison__c}" />
                                </apex:outputText>
                            </apex:outputPanel>

                            <!--Numéro compte client/ Client's Account Number-->

                            <br />
                            <apex:outputPanel layout="none"
                                rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Compte__r.AccountNumber))}">
                                <apex:outputText value=" {!$ObjectType.Account.Fields.AccountNumber.Label} : " />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.AccountNumber}" />&nbsp;
                                <br />
                            </apex:outputPanel>   

                            <!--Numéro de commande/ Order Number-->
                            <apex:outputPanel rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__V_R_f__c))}"
                                layout="none">
                                <apex:outputText value="{!$Label.Sofacto_NumeroCommande}" />&nbsp;
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__V_R_f__c}" />
                                <br />
                            </apex:outputPanel>

                            <!--Numéro de la facture initiale (si type d'avoir)/ Initial invoice number (if credit note)-->
                            <apex:outputPanel layout="none"
                                rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Facture_initiale__c))}">
                                <apex:outputText value=" {!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Facture_initiale__c.Label} : " />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Facture_initiale__c}" />&nbsp;
                            </apex:outputPanel>  

                            <!-- Objet de la facture / Invoice Subject -->                         
                            <apex:outputPanel rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Objet_Facture__c))}" layout="none">
                                <br/><br/>
                                <apex:outputText style="text-transform: uppercase; font-size:10px;"
                                    value="{!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Objet_Facture__c.Label} : " />
                        
                                <apex:outputText  style="text-transform: uppercase; color:#696969; font-size:15px" value="{!sofactoapp__Factures_Client__c.sofactoapp__Objet_Facture__c}" />
                                <br /><br />
                            </apex:outputPanel>

                            <!-- Commentaire supplémentaire / Additional Comments -->  
                            <apex:outputPanel rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Commentaires__c))}" layout="none">
                                <apex:outputText style="text-transform: uppercase; font-size:10px;" value="{!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Commentaires__c.Label} : "/>
                                <i><apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Commentaires__c}" /></i>
                                <br/> <br/> <br/>
                             </apex:outputPanel>       
                        </td>
                        <td style="width:40%" valign="top">

                            <br/><br/>

                            <!-- Adresse d'expedition/ Shipping Address  -->
                            <apex:outputPanel rendered="{!IF(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Compte__r.ShippingStreet)), '', 'none')}">
                                <apex:outputText style="text-transform: uppercase; font-size:7px; text-decoration: underline" value="{!$Label.Sofacto_Adresse3}" /><br /><br />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.Name}" />
                                <br />
                                    <apex:outputPanel layout="none" rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Contact__c))}">
                                        <i>
                                            <apex:outputText value="{!$Label.Sofacto_Adresse2}" />&nbsp;
                                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Contact__r.FirstName} {!sofactoapp__Factures_Client__c.sofactoapp__Contact__r.LastName}" />
                                        </i>
                                    </apex:outputPanel>
                                <br />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.ShippingStreet}" />
                                <br />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.ShippingPostalCode}" />&nbsp;
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.ShippingCity}" />
                                <br />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.ShippingCountry}" />
                                <br />
                            </apex:outputPanel>
                        </td>
                    </tr>
                    <!-- Sauts de ligne/ Line Breaks -->
                    <tr>
                        <td colspan="2">&nbsp;</td>
                    </tr>
                    
                </table>
           
        
        <!--fin header/ end of header-->

        <!-- Corps/ Body -->

        <!--Tableau de facturation/ Invoice Table-->

        <div>

            <!-- Lignes de facture/ Invoice Lines -->

            <table>

                <!-- Ligne entête produits/ Table header -->

                <tr style="text-transform: uppercase; font-size:10px;">
                    <td class="borderOn alignleft"
                        style="width:20%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$ObjectType.sofactoapp__Ligne_de_Facture__c.Fields.sofactoapp__Description__c.Label}" />
                    </td>
                    <td class="borderOn aligncenter"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_PrixUnitaire}" />
                    </td>
                    <td class="borderOn aligncenter"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_Quantite}" />
                    </td>

                    <td class="borderOn aligncenter"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c, '', 'none')}">
                        <apex:outputText value="{!$ObjectType.sofactoapp__Ligne_de_Facture__c.Fields.sofactoapp__Taux_Remise__c.Label}" />
                    </td>
                    <td class="borderOn aligncenter"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black; display:{!IF(sofactoapp__Factures_Client__c.Afficher_montant_remise__c, '', 'none')}">
                        <apex:outputText value="{!$Label.Sofacto_Remise}" />
                    </td>
                    <td class="aligncenter borderOn"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, '', 'none')}">
                        <apex:outputText value="{!$Label.Sofacto_Jalon}" />
                    </td>
                    <td class="borderOn aligncenter"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_HTLigne}" />
                    </td>
                    <td class="borderOn aligncenter"
                        style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_TauxTVA}" />
                    </td>
                </tr>

                <!-- Pour chaque poste de facture/ For each Invoice Line Item -->

                <apex:variable value="{!1}" var="rowNum" />

                <apex:repeat value="{!orderedInvoiceLineItems}" var="orderedLigne" id="orderedLignes">
                    <apex:repeat value="{!sofactoapp__Factures_Client__c.sofactoapp__Lignes_de_Facture__r}" var="ligne"
                        id="lignes">
                        <apex:outputPanel layout="none" rendered="{!ligne.Id == orderedLigne}">
                            <apex:outputPanel layout="none"
                                rendered="{!IF(ligne.sofactoapp__Ordre__c < 10 ,'','none')}">
                                <tr>
                                    <td class="alignleft" style="width:20%">
                                        <apex:outputField value="{!ligne.sofactoapp__Description__c}" />
                                        <apex:outputpanel layout="none"
                                            rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_details_produit__c}">
                                            <br /><span style="font-style: italic;">
                                                <apex:outputField value="{!ligne.sofactoapp__Produit__r.Description}"
                                                    style="font-size:9px;" /></span>
                                        </apex:outputPanel>
                                        <apex:outputpanel layout="none"
                                            rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_description_detaillee__c}">
                                            <br /><span style="font-style: italic;">
                                                <apex:outputField value="{!ligne.sofactoapp__Description_detaillee__c}"
                                                    style="font-size:9px;" /></span>
                                        </apex:outputPanel>
                                    </td>
                                    <td class="alignright" style="width:10%">
                                        <sofactoapp:CurrencyFormat p_amount="{!ligne.sofactoapp__Prix_Unitaire_HT__c}"
                                            rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c}" />
                                        <sofactoapp:CurrencyFormat p_amount="{!ligne.sofactoapp__Prix_unitaire_HT_apres_remise__c}"
                                            rendered="{!NOT(sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c)}" />
                                    </td>
                                    <td class="aligncenter" style="width:10%">
                                        <apex:outputText value="{!ligne.sofactoapp__Quantit__c}" style="width:10%"/>
                                    </td>
                                    <td class="aligncenter"
                                        style="width:10%; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c, '', 'none')}">
                                        <apex:outputPanel rendered="{!IF(ISBLANK(ligne.sofactoapp__Taux_Remise__c),'none','')}">
                                            <apex:outputText value="{0, number, ###.00}%">
                                                <apex:param value="{!ligne.sofactoapp__Taux_Remise__c}" />
                                            </apex:outputText>
                                        </apex:outputPanel>
                                    </td>
                                    <td class="aligncenter"
                                        style="width:10%; display:{!IF(sofactoapp__Factures_Client__c.Afficher_montant_remise__c, '', 'none')}">
                                        <apex:outputPanel rendered="{!IF(ISBLANK(ligne.sofactoapp__Taux_Remise__c),'none','')}">
                                            <sofactoapp:CurrencyFormat p_amount="{!ligne.sofactoapp__Montant_Total_Remise__c}" />
                                        </apex:outputPanel>
                                    </td>
                                    <td class="aligncenter"
                                        style="width:10%; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, '', 'none')}">
                                        <apex:outputPanel rendered="{!IF(ISBLANK(ligne.sofactoapp__Pourcentage__c),'none','')}">
                                            <apex:outputText value="{0, number, ###.00}%">
                                                <apex:param value="{!ligne.sofactoapp__Pourcentage__c}" />
                                            </apex:outputText>
                                        </apex:outputPanel>
                                    </td>
                                    <td class="alignright" style="width:10%">
                                        <sofactoapp:CurrencyFormat p_amount="{!ligne.sofactoapp__Montant_total_HT__c}" />
                                    </td>
                                    <td class="aligncenter" style="width:10%">
                                        <apex:outputField value="{!ligne.sofactoapp__Taux_de_TVA_list__c}" />

                                    </td>
                                </tr>
                                <apex:variable var="rowNum" value="{!rowNum + 1}" />
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:repeat>
                </apex:repeat>

                <!-- Sauts de ligne/ Line Breaks -->
                <tr class="borderOff">
                    <td colspan="3">&nbsp;</td>
                </tr>

                <!-- Voir page suivante/ See next page -->
                <tr>
                    <td class="alignright" colspan="6">
                        <apex:outputPanel rendered="{!IF(rowNum >= 6,'','none')}">
                            <apex:outputText value="{!$Label.Sofacto_ProchainPage}" />
                        </apex:outputPanel>
                    </td>
                </tr>
            </table>

        </div>

        <!--Fin du table de facturation/ End of invoice table-->

        <!--Bas de facture/ Invoice Bottom-->

        <div style="display:{!IF(rowNum < 6,'','none')}">

            <table>
                <!-- Sauts de ligne/ Line Breaks -->
                <tr class="borderOff">
                    <td colspan="3">&nbsp;</td>
                </tr>

                <!-- Ces variables sont utilisé pour garder l'espace dans le tableau pour la remise, / 
                        These variables ensure that you have enough space for your discount, please customize if necessary-->

                <!--var1 pour le tableau de la remise/ var1 for the Discout Table-->

                <apex:variable var="colspan1"
                    value="{!IF
                                    (AND 
                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 2,
                                            IF
                                                (OR
                                                    (AND
                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, 
                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c),
                                                    AND
                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c),
                                                    AND
                                                        (sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c)
                                                    ), 1,
                                                        IF 
                                                            (OR 
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 1, 1)))}" />

                <!--var2 pour le tableau Répartition TVA / var2 for the VAT Table -->

                <apex:variable var="colspan2"
                    value="{!IF
                                    (AND 
                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 6,
                                            IF
                                                (OR
                                                    (AND
                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, 
                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c),
                                                    AND
                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c),
                                                    AND
                                                        (sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c)
                                                    ), 5,
                                                        IF 
                                                            (OR 
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 4, 3)))}" />


                <!--var3 pour le montant TTC/ var3 for amount after taxes -->


                <apex:variable var="colspan3"
                    value="{!IF
                                    (AND 
                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 10,
                                            IF
                                                (OR
                                                    (AND
                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, 
                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c),
                                                    AND
                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c),
                                                    AND
                                                        (sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c)
                                                    ), 9,
                                                        IF 
                                                            (OR 
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 8, 7)))}" />




                <!--Tableau Répartition TVA/ VAT Distribution Table-->

                <tr style="font-size:10px; text-transform: uppercase">
                    <td class="borderOff" colspan="{!colspan2}">&nbsp;
                    </td>
                    <td class="borderOn alignleft" colspan="2"
                        style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <b>
                            <apex:outputText value="{!$Label.Sofacto_TVA2}" /></b>
                    </td>
                    <td class="borderOn aligncenter"
                        style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_TauxTVA}" />
                    </td>
                    <td class="borderOn aligncenter"
                        style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_TVA}" />
                    </td>

                </tr>

                <!--TVA 20%/ VAT 20%-->

                <tr class="borderOff" style="display:{!IF(sofactoapp__Factures_Client__c.TotalTVA20__c > 0,'', 'none')}">
                    <td class="borderOff" colspan="{!colspan2}">&nbsp;
                    </td>
                    <td colspan="2">&nbsp;
                    </td>
                    <td class="aligncenter">
                        <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA20__c > 0,'', 'none')}">
                            <apex:outputText value="20%" />
                        </apex:outputPanel>
                    </td>
                    <td class="alignright">
                        <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA20__c > 0,'', 'none')}">
                            <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.TotalTVA20__c}" />
                        </apex:outputPanel>
                    </td>
                </tr>


                <!--TVA 10%/ VAT 10%-->

                <tr class="borderOff" style="display:{!IF(sofactoapp__Factures_Client__c.TotalTVA10__c > 0,'', 'none')}">
                    <td class="borderOff" colspan="{!colspan2}">&nbsp;
                    </td>
                    <td colspan="2">&nbsp;
                    </td>
                    <td class="aligncenter">
                        <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA10__c > 0,'', 'none')}">
                            <apex:outputText value="10%" />
                        </apex:outputPanel>
                    </td>
                    <td class="alignright">
                        <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA10__c > 0,'', 'none')}">
                            <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.TotalTVA10__c}" />
                        </apex:outputPanel>
                    </td>
                </tr>


                <!--TVA 5,5%/ VAT 5,5%-->

                <tr class="borderOff" style="display:{!IF(sofactoapp__Factures_Client__c.TotalTVA55__c > 0,'', 'none')}">
                    <td class="borderOff" colspan="{!colspan2}">&nbsp;
                    </td>
                    <td colspan="2">&nbsp;
                    </td>
                    <td class="aligncenter">
                        <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA55__c > 0,'', 'none')}">
                            <apex:outputText value="5,5%" />
                        </apex:outputPanel>
                    </td>
                    <td class="alignright">
                        <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA55__c > 0,'', 'none')}">
                            <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.TotalTVA55__c}" />
                        </apex:outputPanel>
                    </td>
                </tr>





                <!-- Saut de ligne / Line Break -->
                <tr>
                    <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                </tr>
                <tr>
                    <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                </tr>

                <!-- Tableau de Remise / Table of Discounts -->


                <tr
                    style="font-size:10px; text-transform: uppercase; display:{!IF (sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}; ">

                    <td class="borderOff" colspan="{!colspan1}">&nbsp;</td>
                    <td class="alignleft borderOn" colspan="2"
                        style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputPanel layout="none"
                            rendered="{!IF(sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}">
                            <b>
                                <apex:outputText value="{!$Label.Sofacto_RemiseBasPage}" /></b>
                        </apex:outputPanel>
                    </td>

                    <apex:outputPanel layout="none"
                        rendered="{!IF(NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c)), '', 'none')}">
                        <td class="alignleft borderOn" colspan="2"
                            style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                            <apex:outputText value="{!$Label.Sofacto_RaisonRemise}" />
                        </td>
                    </apex:outputPanel>

                    <apex:outputPanel layout="none"
                        rendered="{!IF(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c), '', 'none')}">
                        <td class="borderOff" colspan="2">&nbsp;</td>
                    </apex:outputPanel>

                    <td colspan="2" class="aligncenter borderOn"
                        style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$ObjectType.sofactoapp__Ligne_de_Facture__c.Fields.sofactoapp__Taux_Remise__c.Label}" />
                    </td>
                    <td class="alignright borderOn"
                        style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                        <apex:outputText value="{!$Label.Sofacto_Remise}" />
                    </td>
                </tr>
            
                <tr
                    style="display:{!IF (sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}">

                    <td class="borderOff" colspan="{!colspan1}">&nbsp;</td>
                    <td colspan="2">&nbsp;
                    </td>
                    <apex:outputPanel layout="none"
                        rendered="{!IF(NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c)), '', 'none')}">
                        <td class="alignleft" colspan="2">
                            <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c}" />
                        </td>
                    </apex:outputPanel>

                    <apex:outputPanel layout="none"
                        rendered="{!IF(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c), '', 'none')}">
                        <td class="borderOff" colspan="2">&nbsp;</td>
                    </apex:outputPanel>

                    <td colspan="2" class="aligncenter">
                        <apex:outputText value="{0, number, ###.00}%">
                            <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Discount_rate__c}" />
                        </apex:outputText>
                    </td>
                    <td class="alignright">
                        <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c}" />
                    </td>
                </tr>

                <!-- Saut de ligne/ Line Break -->

                <tr
                    style="display:{!IF (sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}">
                    <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                </tr>

                <!-- Net à payer/ Balance due -->

                <tr class="borderOff">
                    <td colspan="{!colspan3}" class="alignright">
                        <apex:outputPanel style="color:#696969;font-size:20px">
                            <apex:outputText style="font-size:10px" value="{!$Label.Sofacto_TTC}" />
                            <br />
                            <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.sofactoapp__Amount_VAT__c}" />
                        </apex:outputPanel>
                    </td>
                </tr>

                <!-- Saut de ligne/ Line Break -->

                <tr>
                    <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                </tr>
                <tr>
                    <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                </tr>

            </table>
        </div>

        
    

        <!-- ///////////////////////////////////////////////////////////////////////////////////////////  -->
        <!-- ////////////////////////////////// Page 2 //////////////////////////////////////////////////  -->
        <!-- ///////////////////////////////////////////////////////////////////////////////////////////  -->
        <!-- ///////////////////////////////////////////////////////////////////////////////////////////  -->
        
            <div style="page-break-before:always">
                

                <!-- Structure principale/ Main Structure -->

                <table>
                    <tr>
                        <td class="col33"></td>
                        <td class="col33"></td>
                        <td class="col33"></td>
                    </tr>

                    <!-- Référence de la Facture - Logo/ Invoice Number - Logo -->

                    <tr>
                        <td colspan="2" class="borderOff">

                            <!--Type de la facture/ Invoice type -->

                            <apex:outputPanel style="text-transform: uppercase; color:#696969; font-size:25px">
                                <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Type_de_facture__c}" />&nbsp;
                            </apex:outputPanel>

                            <!--Mention Proforma -->

                            <apex:outputText value="PROFORMA" style="color:color:#696969;font-size:25px" rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c == false && 
                                    NOT(ISBLANK($CurrentPage.parameters.proforma))}" />

                            <!--Référence de la facture (émise)/ (Issued) Invoice reference -->

                            <apex:outputText style="font-size:25px; color:#696969"
                                value=" N° {!sofactoapp__Factures_Client__c.sofactoapp__Reference__c}"
                                rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c}" />

                            <!--Nom de la facture (brouillon)/ (Draft) Invoice name -->

                            <apex:outputText style="font-size:25px; color:#696969"
                                value=" N° {!sofactoapp__Factures_Client__c.Name}"
                                rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c == false}" />

                            <!--Sous-type Avoir/ Credit Note Subtype-->

                            <br />
                            <i>
                                <apex:outputText style="font-size:13px"
                                    value="{!sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c}"
                                    rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c))}" />
                            </i>

                            <!--Date de la facture/ Invoice Date -->

                           <apex:outputPanel rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c}" >
                                <apex:outputText value="{!$Label.Sofacto_DateEmission}" />&nbsp;
                                <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                    <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_de_facture__c}" />
                                </apex:outputText>
                            </apex:outputPanel>

                            <!--Date de livraison/ Shipping Date -->

                            <apex:outputPanel rendered="{!IF(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Date_de_livraison__c)),'','none')}">
                                <apex:outputText value="{!$Label.Sofacto_DateLivraison}" />&nbsp;
                                <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                    <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_de_livraison__c}" />
                                </apex:outputText>
                            </apex:outputPanel>

                            <!--Numéro compte client/ Client's Account Number-->

                            <br />
                            <apex:outputPanel layout="none"
                                rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Compte__r.AccountNumber))}">
                                <apex:outputText value=" {!$ObjectType.Account.Fields.AccountNumber.Label} : " />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.AccountNumber}" />
                                &nbsp;
                            </apex:outputPanel>

                            <br />

                            <!--Numéro de commande/ Order Number-->
                            <apex:outputPanel rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__V_R_f__c))}"
                                layout="none">
                                <apex:outputText value="{!$Label.Sofacto_NumeroCommande}" />&nbsp;
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__V_R_f__c}" />
                                <br />
                            </apex:outputPanel>

                            <!--Numéro de la facture initiale (si type d'avoir)/ Initial invoice number (if credit note)-->
                            <apex:outputPanel layout="none"
                                rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Facture_initiale__c))}">
                                <apex:outputText value=" {!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Facture_initiale__c.Label} : " />
                                <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Facture_initiale__c}" />&nbsp;
                            </apex:outputPanel>


                        </td>
                        <td colspan="1" class="alignright">
                            <apex:image id="logo2"
                                value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c}"
                                styleClass="logo" alt="Logo"
                                rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c))}"
                                style="float:right; height: 150px  " />

                            <!-- Si pas de logo, garder l'espace pour présentation de page / If no logo, holding the space for page layout-->
                            <apex:outputPanel rendered="{!ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c)}">
                                <div style="height: 150px;width: 300px; background-color: transparent">&nbsp;</div>
                            </apex:outputPanel>
                        </td>
                    </tr>

                </table>

                <!--Tableau de facturation page 2/ Invoice Table 2nd page-->

              

                   <!-- Lignes de facture/ Invoice Lines -->

                    <table>

                        <!-- Ligne entête produits/ Table header -->
        
                        <tr style="text-transform: uppercase; font-size:10px; display:{!IF(rowNum >= 10,'','none')}">
                            <td class="borderOn alignleft"
                                style="width:20%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;"
                                colspan="2">
                                <apex:outputText value="{!$ObjectType.sofactoapp__Ligne_de_Facture__c.Fields.sofactoapp__Description__c.Label}" />
                            </td>
                            <td class="borderOn aligncenter"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_PrixUnitaire}" />
                            </td>
                            <td class="borderOn aligncenter"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_Quantite}" />
                            </td>
        
                            <td class="borderOn aligncenter"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c, '', 'none')}">
                                <apex:outputText value="{!$ObjectType.sofactoapp__Ligne_de_Facture__c.Fields.sofactoapp__Taux_Remise__c.Label}" />
                            </td>
                            <td class="borderOn aligncenter"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black; display:{!IF(sofactoapp__Factures_Client__c.Afficher_montant_remise__c, '', 'none')}">
                                <apex:outputText value="{!$Label.Sofacto_Remise}" />
                            </td>
                            <td class="aligncenter borderOn"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, '', 'none')}">
                                <apex:outputText value="{!$Label.Sofacto_Jalon}" />
                            </td>
                            <td class="borderOn aligncenter"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_HTLigne}" />
                            </td>
                            <td class="borderOn aligncenter"
                                style="width:10%;border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_TauxTVA}" />
                            </td>
                        </tr>
        
                        <!-- Pour chaque poste de facture/ For each Invoice Line Item -->
        
                        <apex:repeat value="{!orderedInvoiceLineItems}" var="orderedLigne2" id="orderedLignes2">
                            <apex:repeat value="{!sofactoapp__Factures_Client__c.sofactoapp__Lignes_de_Facture__r}" var="ligne2"
                                id="lignes2">
                                <apex:outputPanel layout="none" rendered="{!ligne2.Id == orderedLigne2}">
                                    <apex:outputPanel layout="none"
                                        rendered="{!IF(ligne2.sofactoapp__Ordre__c >= 10 ,'','none')}">
                                        <tr class="borderOff">
                                            <td class="alignleft" style="width:20%">
                                                <apex:outputField value="{!ligne2.sofactoapp__Description__c}" />
                                                <apex:outputpanel layout="none"
                                                    rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_details_produit__c}">
                                                    <br /><span style="font-style: italic;">
                                                        <apex:outputField value="{!ligne2.sofactoapp__Produit__r.Description}"
                                                            style="font-size:9px;" /></span>
                                                </apex:outputPanel>
                                                <apex:outputpanel layout="none"
                                                    rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_description_detaillee__c}">
                                                    <br /><span style="font-style: italic;">
                                                        <apex:outputField value="{!ligne2.sofactoapp__Description_detaillee__c}"
                                                            style="font-size:9px;" /></span>
                                                </apex:outputPanel>
                                            </td>
                                            <td class="alignright" style="width:10%">
                                                <sofactoapp:CurrencyFormat p_amount="{!ligne2.sofactoapp__Prix_Unitaire_HT__c}"
                                                    rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c}" />
                                                <sofactoapp:CurrencyFormat p_amount="{!ligne2.sofactoapp__Prix_unitaire_HT_apres_remise__c}"
                                                    rendered="{!NOT(sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c)}" />
                                            </td>
                                            <td class="aligncenter" style="width:10%">
                                                <apex:outputText value="{!ligne2.sofactoapp__Quantit__c}" />
                                            </td>
                                            <td class="aligncenter"
                                                style="width:10%; display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c, '', 'none')}">
                                                <apex:outputPanel rendered="{!IF(ISBLANK(ligne2.sofactoapp__Taux_Remise__c),'none','')}">
                                                    <apex:outputText value="{0, number, ###.00}%">
                                                        <apex:param value="{!ligne2.sofactoapp__Taux_Remise__c}" />
                                                    </apex:outputText>
                                                </apex:outputPanel>
                                            </td>
                                            <td class="aligncenter"
                                                style="width:10%;display:{!IF(sofactoapp__Factures_Client__c.Afficher_montant_remise__c, '', 'none')}">
                                                <apex:outputPanel rendered="{!IF(ISBLANK(ligne2.sofactoapp__Taux_Remise__c),'none','')}">
                                                    <sofactoapp:CurrencyFormat p_amount="{!ligne2.sofactoapp__Montant_Total_Remise__c}" />
                                                </apex:outputPanel>
                                            </td>
                                            <td class="aligncenter"
                                                style="width:10%;display:{!IF(sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, '', 'none')}">
                                                <apex:outputPanel rendered="{!IF(ISBLANK(ligne2.sofactoapp__Pourcentage__c),'none','')}">
                                                    <apex:outputText value="{0, number, ###.00}%">
                                                        <apex:param value="{!ligne2.sofactoapp__Pourcentage__c}" />
                                                    </apex:outputText>
                                                </apex:outputPanel>
                                            </td>
                                            <td style="width:10%" class="alignright">
                                                <sofactoapp:CurrencyFormat p_amount="{!ligne2.sofactoapp__Montant_total_HT__c}" />
                                            </td>
                                            <td style="width:10%" class="aligncenter">
                                                <apex:outputField value="{!ligne2.sofactoapp__Taux_de_TVA_list__c}" />
        
                                            </td>
                                        </tr>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:repeat>
                        </apex:repeat>
        
                        <!-- Sauts de ligne/ Line Breaks-->
                        <tr class="borderOff">
                            <td colspan="3">&nbsp;</td>
                        </tr>

                    </table>
                 


            
         <!--Partie qui est juste affiché, si elle rentre plus sur la première page/ Part that is just displayed if it is not fitting on the first page-->
            <div style="display:{!IF(rowNum >= 6,'','none')}">
                    <table>
                        <!-- Sauts de ligne/ Line Breaks -->
                        <tr class="borderOff">
                            <td colspan="3">&nbsp;</td>
                        </tr>
        
                        <!-- Ces variables sont utilisé pour garder l'espace dans le tableau pour la remise, / 
                                These variables ensure that you have enough space for your discount, please customize if necessary-->
        
                        <!--var1 pour le tableau de la remise/ var1 for the Discout Table-->
        
                        <apex:variable var="colspan1"
                            value="{!IF
                                            (AND 
                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 2,
                                                    IF
                                                        (OR
                                                            (AND
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, 
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c),
                                                            AND
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c),
                                                            AND
                                                                (sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c)
                                                            ), 1,
                                                                IF 
                                                                    (OR 
                                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 1, 1)))}" />
        
                        <!--var2 pour le tableau Répartition TVA / var2 for the VAT Table -->
        
                        <apex:variable var="colspan2"
                            value="{!IF
                                            (AND 
                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 7,
                                                    IF
                                                        (OR
                                                            (AND
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, 
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c),
                                                            AND
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c),
                                                            AND
                                                                (sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c)
                                                            ), 6,
                                                                IF 
                                                                    (OR 
                                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 5, 4)))}" />
        
        
                        <!--var3 pour le montant TTC/ var3 for amount after taxes -->
        
        
                        <apex:variable var="colspan3"
                            value="{!IF
                                            (AND 
                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 11,
                                                    IF
                                                        (OR
                                                            (AND
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c, 
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c),
                                                            AND
                                                                (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                sofactoapp__Factures_Client__c.Afficher_montant_remise__c),
                                                            AND
                                                                (sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c)
                                                            ), 10,
                                                                IF 
                                                                    (OR 
                                                                        (sofactoapp__Factures_Client__c.sofactoapp__Afficher_remise__c,
                                                                        sofactoapp__Factures_Client__c.Afficher_montant_remise__c,
                                                                        sofactoapp__Factures_Client__c.sofactoapp__Afficher_pourcentage__c ), 9, 8)))}" />
        
        
        
        
                        <!--Tableau Répartition TVA/ VAT Distribution Table-->
        
                        <tr style="font-size:10px; text-transform: uppercase">
                            <td class="borderOff" colspan="{!colspan2}">&nbsp;
                            </td>
                            <td class="borderOn alignleft" colspan="2"
                                style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <b>
                                    <apex:outputText value="{!$Label.Sofacto_TVA2}" /></b>
                            </td>
                            <td class="borderOn aligncenter"
                                style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_TauxTVA}" />
                            </td>
                            <td class="borderOn aligncenter"
                                style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_TVA}" />
                            </td>
        
                        </tr>
        
                        <!--TVA 20%/ VAT 20%-->
        
                        <tr class="borderOff" style="display:{!IF(sofactoapp__Factures_Client__c.TotalTVA20__c > 0,'', 'none')}">
                            <td class="borderOff" colspan="{!colspan2}">&nbsp;
                            </td>
                            <td colspan="2">&nbsp;
                            </td>
                            <td class="aligncenter">
                                <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA20__c > 0,'', 'none')}">
                                    <apex:outputText value="20%" />
                                </apex:outputPanel>
                            </td>
                            <td class="alignright">
                                <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA20__c > 0,'', 'none')}">
                                    <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.TotalTVA20__c}" />
                                </apex:outputPanel>
                            </td>
                        </tr>
        
        
                        <!--TVA 10%/ VAT 10%-->
        
                        <tr class="borderOff" style="display:{!IF(sofactoapp__Factures_Client__c.TotalTVA10__c > 0,'', 'none')}">
                            <td class="borderOff" colspan="{!colspan2}">&nbsp;
                            </td>
                            <td colspan="2">&nbsp;
                            </td>
                            <td class="aligncenter">
                                <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA10__c > 0,'', 'none')}">
                                    <apex:outputText value="10%" />
                                </apex:outputPanel>
                            </td>
                            <td class="alignright">
                                <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA10__c > 0,'', 'none')}">
                                    <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.TotalTVA10__c}" />
                                </apex:outputPanel>
                            </td>
                        </tr>
        
        
                        <!--TVA 5,5%/ VAT 5,5%-->
        
                        <tr class="borderOff" style="display:{!IF(sofactoapp__Factures_Client__c.TotalTVA55__c > 0,'', 'none')}">
                            <td class="borderOff" colspan="{!colspan2}">&nbsp;
                            </td>
                            <td colspan="2">&nbsp;
                            </td>
                            <td class="aligncenter">
                                <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA55__c > 0,'', 'none')}">
                                    <apex:outputText value="5,5%" />
                                </apex:outputPanel>
                            </td>
                            <td class="alignright">
                                <apex:outputPanel rendered="{!IF(sofactoapp__Factures_Client__c.TotalTVA55__c > 0,'', 'none')}">
                                    <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.TotalTVA55__c}" />
                                </apex:outputPanel>
                            </td>
                        </tr>
        
        
        
        
        
                        <!-- Saut de ligne / Line Break -->
                        <tr>
                            <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                        </tr>
                        <tr>
                            <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                        </tr>
        
                        <!-- Tableau de Remise / Table of Discounts -->
                    
                        
        
                        <tr
                            style="font-size:10px; text-transform: uppercase; display:{!IF (sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}; ">
        
                            <td class="borderOff" colspan="{!colspan1}">&nbsp;</td>
                            <td class="alignleft borderOn" colspan="2"
                                style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputPanel layout="none"
                                    rendered="{!IF(sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}">
                                    <b>
                                        <apex:outputText value="{!$Label.Sofacto_RemiseBasPage}" /></b>
                                </apex:outputPanel>
                            </td>
        
                            <apex:outputPanel layout="none"
                                rendered="{!IF(NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c)), '', 'none')}">
                                <td class="alignleft borderOn" colspan="2"
                                    style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                    <apex:outputText value="{!$Label.Sofacto_RaisonRemise}" />
                                </td>
                            </apex:outputPanel>
        
                            <apex:outputPanel layout="none"
                                rendered="{!IF(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c), '', 'none')}">
                                <td class="borderOff" colspan="2">&nbsp;</td>
                            </apex:outputPanel>
        
                            <td colspan="2" class="aligncenter borderOn"
                                style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$ObjectType.sofactoapp__Ligne_de_Facture__c.Fields.sofactoapp__Taux_Remise__c.Label}" />
                            </td>
                            <td class="alignright borderOn"
                                style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                                <apex:outputText value="{!$Label.Sofacto_Remise}" />
                            </td>
                        </tr>
                    
                        <tr
                            style="display:{!IF (sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}">
        
                            <td class="borderOff" colspan="{!colspan1}">&nbsp;</td>
                            <td colspan="2">&nbsp;
                            </td>
                            <apex:outputPanel layout="none"
                                rendered="{!IF(NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c)), '', 'none')}">
                                <td class="alignleft" colspan="2">
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c}" />
                                </td>
                            </apex:outputPanel>
        
                            <apex:outputPanel layout="none"
                                rendered="{!IF(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Discount_description__c), '', 'none')}">
                                <td class="borderOff" colspan="2">&nbsp;</td>
                            </apex:outputPanel>
        
                            <td colspan="2" class="aligncenter">
                                <apex:outputText value="{0, number, ###.00}%">
                                    <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Discount_rate__c}" />
                                </apex:outputText>
                            </td>
                            <td class="alignright">
                                <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c}" />
                            </td>
                        </tr>
        
                        <!-- Saut de ligne/ Line Break -->
        
                        <tr
                            style="display:{!IF (sofactoapp__Factures_Client__c.sofactoapp__Discount_amount__c > 0, '', 'none')}">
                            <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                        </tr>
        
                        <!-- Net à payer/ Balance due -->
        
                        <tr class="borderOff">
                            <td colspan="{!colspan3}" class="alignright">
                                <apex:outputPanel style="color:#696969;font-size:20px">
                                    <apex:outputText style="font-size:10px" value="{!$Label.Sofacto_TTC}" />
                                    <br />
                                    <sofactoapp:CurrencyFormat p_amount="{!sofactoapp__Factures_Client__c.sofactoapp__Amount_VAT__c}" />
                                </apex:outputPanel>
                            </td>
                        </tr>
        
                        <!-- Saut de ligne/ Line Break -->
        
                        <tr>
                            <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                        </tr>
                        <tr>
                            <td colspan="{!colspan1}" class="borderOff">&nbsp;</td>
                        </tr>
        
                    </table>
            </div>
                   
                    <!-- Conditions particulières/ Special Conditions -->

                    <table>
                        <apex:outputPanel layout="none"
                            rendered="{!IF(NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Conditions_Particuli_res__c)), '', 'none')}">
                            <tr style="font-size:10px; text-transform: uppercase">
                                <td class="borderOn"
                                    style="border-left: hidden; border-right: hidden; border-top:0.2px solid black;border-bottom:hidden">

                                    <br />
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Conditions_Particuli_res__c.Label}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Conditions_Particuli_res__c}" />
                                    <br /><br />
                                </td>
                            </tr>
                        </apex:outputPanel>


                        <!--Pénalités en cas de retard/ Penalties in case of delay-->

                        <apex:outputPanel layout="none"
                            rendered="{!IF(NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__P_nalit_s_en_cas_de_retard__c)), '', 'none')}">
                            <tr style="font-size:10px; text-transform: uppercase">
                                <td class="borderOn"
                                    style="border-left: hidden; border-right: hidden; border-top:0.2px solid black;border-bottom:hidden">

                                    <br />
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Raison_Sociale__c.Fields.sofactoapp__P_nalit_s_en_cas_de_retard__c.Label}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__P_nalit_s_en_cas_de_retard__c}" />
                                    <br /><br />
                                </td>
                            </tr>
                        </apex:outputPanel>

                    </table>

                    <!-- Indices/ Indexes -->
                    <table>
                        <tr>
                            <td class="borderOff">
                                <apex:outputPanel layout="none"
                                    rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__IndiceId__c))}">
                                    <br />
                                    <br />Prix révisé selon la formule P1 = P0 x (S1 / S0)

                                    <br />
                                    <apex:outputText value="S0 = indice {!sofactoapp__Factures_Client__c.sofactoapp__Abonnement__r.sofactoapp__Indice__r.Name} {0,date,dd'/'MM'/'yyyy}">
                                        <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Abonnement__r.sofactoapp__Date_indice_reference__c}" />
                                    </apex:outputText>
                                    &nbsp;=&nbsp;
                                    <apex:outputText value="{!FLOOR(sofactoapp__Factures_Client__c.sofactoapp__Abonnement__r.sofactoapp__Coefficient_indice_reference__c)}" />


                                    <br />
                                    <apex:outputText value="S1 = indice {!sofactoapp__Factures_Client__c.sofactoapp__Abonnement__r.sofactoapp__Indice__r.Name} {0,date,dd'/'MM'/'yyyy}">
                                        <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_indice__c}" />
                                    </apex:outputText>
                                    &nbsp;=&nbsp;
                                    <apex:outputText value="{!FLOOR(sofactoapp__Factures_Client__c.sofactoapp__Coefficient_indice_date__c)}" />
                                    <br />
                                </apex:outputPanel>
                            </td>
                        </tr>
                    </table>


                    <br />

                    <!-- Coordonnées bancaires/ Bank Information -->

                    <apex:outputPanel layout="none"
                        rendered="{!sofactoapp__Factures_Client__c.sofactoapp__Afficher_coordonnees_bancaires__c && OR(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c)), NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Emetteur_facture__r.sofactoapp__Coordonnees_bancaires_par_defaut__c)))}"
                        style="font-size:9px">
                        <br />
                        <table class="borderOn"
                            style="width:100%;page-break-inside: avoid;font-size:9px;font-family: serif;">
                            <tr style="text-transform: uppercase;">
                                <td>
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Ech_ance__c.Label}" />
                                </td>
                                <td class="borderOn">
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Payment_mode__c.Label}" />
                                </td>
                                <td class="borderOn">
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Delai_paiement__c.Label}" />
                                </td>
                                <td class="borderOn">
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Coordonnees_bancaires__c.Fields.sofactoapp__Banque__c.Label}" />
                                </td>
                                <td class="borderOn">
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Coordonnees_bancaires__c.Fields.sofactoapp__IBAN__c.Label}" />
                                </td>
                                <td class="borderOn">
                                    <apex:outputText value="{!$ObjectType.sofactoapp__Coordonnees_bancaires__c.Fields.sofactoapp__BIC__c.Label}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                        <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Ech_ance__c}" />
                                    </apex:outputText>
                                </td>
                                <td>
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Payment_mode__c}" />
                                </td>
                                <td>
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Delai_paiement__c}" />
                                </td>
                                <td>
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Emetteur_facture__r.sofactoapp__Coordonnees_bancaires_par_defaut__r.sofactoapp__Banque__c}"
                                        rendered="{!ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c)}" />
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__r.sofactoapp__Banque__c}"
                                        rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c))}" />
                                </td>
                                <td>
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Emetteur_facture__r.sofactoapp__Coordonnees_bancaires_par_defaut__r.sofactoapp__IBAN__c}"
                                        rendered="{!ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c)}" />
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__r.sofactoapp__IBAN__c}"
                                        rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c))}" />
                                </td>
                                <td>
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Emetteur_facture__r.sofactoapp__Coordonnees_bancaires_par_defaut__r.sofactoapp__BIC__c}"
                                        rendered="{!ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c)}" />
                                    <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__r.sofactoapp__BIC__c}"
                                        rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Autres_coordonnees_bancaires__c))}" />
                                </td>
                            </tr>
                            <tr>
                                <td class="borderOff">&nbsp;</td>
                            </tr>
                            <tr>
                                <td  class="borderOff">&nbsp;</td>
                            </tr>

                        </table>
                        
                    </apex:outputPanel>
                
            </div>
        <!-- ///////////////////////////////////////////////////////////////////////////////////////////  -->
        <!-- ////////////////////////////////// Page 3 //////////////////////////////////////////////////  -->
        <!-- ///////////////////////////////////////////////////////////////////////////////////////////  -->
        <!-- ///////////////////////////////////////////////////////////////////////////////////////////  -->
        
        <div style="page-break-before:always">
            <div style="display:{!IF(sofactoapp__Factures_Client__c.Afficher_Echeancier_de_reglement__c, '', 'none')}">
                

            <!-- Structure principale/ Main Structure -->

            <table>
                <tr>
                    <td class="col33"></td>
                    <td class="col33"></td>
                    <td class="col33"></td>
                </tr>

                <!-- Référence de la Facture - Logo/ Invoice Number - Logo -->

                <tr>
                    <td colspan="2" class="borderOff">

                       <!--Type de la facture/ Invoice type -->

                            <apex:outputPanel style="text-transform: uppercase; color:#696969; font-size:25px">
                                <apex:outputField value="{!sofactoapp__Factures_Client__c.sofactoapp__Type_de_facture__c}" />&nbsp;
                            </apex:outputPanel>

                        <!--Mention Proforma -->

                        <apex:outputText value="PROFORMA" style="color:color:#696969;font-size:25px" rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c == false && 
                                NOT(ISBLANK($CurrentPage.parameters.proforma))}" />

                        <!--Référence de la facture (émise)/ (Issued) Invoice reference -->

                        <apex:outputText style="font-size:25px; color:#696969"
                            value=" N° {!sofactoapp__Factures_Client__c.sofactoapp__Reference__c}"
                            rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c}" />

                        <!--Nom de la facture (brouillon)/ (Draft) Invoice name -->

                        <apex:outputText style="font-size:25px; color:#696969"
                            value=" N° {!sofactoapp__Factures_Client__c.Name}"
                            rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c == false}" />

                        <!--Sous-type Avoir/ Credit Note Subtype-->

                        <br />
                        <i>
                            <apex:outputText style="font-size:13px"
                                value="{!sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c}"
                                rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Sous_type__c))}" />
                        </i>

                        <!--Date de la facture/ Invoice Date -->

                       <apex:outputPanel rendered="{!sofactoapp__Factures_Client__c.sofactoapp__IsSent__c}" >
                            <apex:outputText value="{!$Label.Sofacto_DateEmission}" />&nbsp;
                            <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_de_facture__c}" />
                            </apex:outputText>
                        </apex:outputPanel>

                        <!--Date de livraison/ Shipping Date -->

                        <apex:outputPanel rendered="{!IF(NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__Date_de_livraison__c)),'','none')}">
                            <apex:outputText value="{!$Label.Sofacto_DateLivraison}" />&nbsp;
                            <apex:outputText value="{0,date,dd'/'MM'/'yyyy}">
                                <apex:param value="{!sofactoapp__Factures_Client__c.sofactoapp__Date_de_livraison__c}" />
                            </apex:outputText>
                        </apex:outputPanel>

                        <!--Numéro compte client/ Client's Account Number-->

                        <br />
                        <apex:outputPanel layout="none"
                            rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Compte__r.AccountNumber))}">
                            <apex:outputText value=" {!$ObjectType.Account.Fields.AccountNumber.Label} : " />
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Compte__r.AccountNumber}" />
                            &nbsp;
                        </apex:outputPanel>

                        <br />

                        <!--Numéro de commande/ Order Number-->
                        <apex:outputPanel rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__V_R_f__c))}"
                            layout="none">
                            <apex:outputText value="{!$Label.Sofacto_NumeroCommande}" />&nbsp;
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__V_R_f__c}" />
                            <br />
                        </apex:outputPanel>

                        <!--Numéro de la facture initiale (si type d'avoir)/ Initial invoice number (if credit note)-->
                        <apex:outputPanel layout="none"
                            rendered="{!NOT(ISNULL(sofactoapp__Factures_Client__c.sofactoapp__Facture_initiale__c))}">
                            <apex:outputText value=" {!$ObjectType.sofactoapp__Factures_Client__c.Fields.sofactoapp__Facture_initiale__c.Label} : " />
                            <apex:outputText value="{!sofactoapp__Factures_Client__c.sofactoapp__Facture_initiale__c}" />&nbsp;
                        </apex:outputPanel>


                    </td>
                    <td colspan="1" class="alignright">
                        <apex:image id="logo3"
                            value="{!sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c}"
                            styleClass="logo" alt="Logo"
                            rendered="{!NOT(ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c))}"
                            style="float:right; height: 150px  " />

                        <!-- Si pas de logo, garder l'espace pour présentation de page / If no logo, holding the space for page layout-->
                        <apex:outputPanel rendered="{!ISBLANK(sofactoapp__Factures_Client__c.sofactoapp__emetteur_facture__r.sofactoapp__Logo__c)}">
                            <div style="height: 150px;width: 300px; background-color: transparent">&nbsp;</div>
                        </apex:outputPanel>
                    </td>
                </tr>

            </table>

                <!-- Echéancier/ Payment Plan -->

                <table class="borderOn" style="padding:0; margin:0;page-break-before:auto; page-break-inside: auto;">
                    <tr style="font-size:10px; text-transform: uppercase">
                        <td colspan="5" class="borderOn"
                        style="border-left: hidden; border-right: hidden;border-top:0.2px solid black; border-bottom:hidden; ">
                        <br/>
                        <apex:outputText value="{!$Label.Sofacto_EcheancierReglement}" />
                        </td>
                    </tr>
                    <tr style="font-size:10px; text-transform: uppercase">
                        <td colspan="5" class="borderOff">
                            &nbsp;
                        </td>
                    </tr>

                    <tr style="page-break-inside:avoid; page-break-before:auto; font-size:10px; text-transform: uppercase">
                        <td width="10%" class="alignleft borderOn"
                            style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                            N°
                        </td>
                        <td width="18%" class="alignleft borderOn"
                            style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                            {!$ObjectType.sofactoapp__R_glement__c.Fields.sofactoapp__Date__c.Label}
                        </td>
                        <td width="18%" class="alignleft borderOn"
                            style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                            {!$ObjectType.sofactoapp__R_glement__c.Fields.Montant_HT__c.Label}
                        </td>
                        <td width="18%" class="alignleft borderOn"
                            style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                            {!$ObjectType.sofactoapp__R_glement__c.Fields.Montant_TVA__c.Label}
                        </td>
                        <td width="18%" class="alignleft borderOn"
                            style="border-left: hidden; border-right: hidden; border-top:hidden; border-bottom:0.2px solid black;">
                            {!$ObjectType.sofactoapp__R_glement__c.Fields.sofactoapp__Montant__c.Label}
                        </td>
                        
                    </tr>
                    ​
                    <apex:variable var="counter" value="{!1}" />
                    <apex:repeat value="{!orderedPayments}" var="orderedPaymentsLigne" id="orderedPaymentsLignes">
                        <apex:repeat value="{!sofactoapp__Factures_Client__c.sofactoapp__R_glements__r}" var="paymentLigne"
                            id="paymentLignes">
                            <apex:outputPanel layout="none" rendered="{!paymentLigne.Id == orderedPaymentsLigne}">
                                <apex:outputPanel layout="none">

                                    <tr style="page-break-inside:avoid; page-break-before:auto">
                                        <td width="10%" style="text-align:center;">
                                            <apex:outputText value="{!counter}" />
                                            <apex:variable var="counter" value="{!counter+ 1}" />
                                        </td>
                                        <td width="18%" style="text-align:center;">
                                            <apex:outputField value="{!paymentLigne.sofactoapp__Date__c}" />
                                        </td>
                                        <td width="18%" style="text-align:center;">
                                            <apex:outputField value="{!paymentLigne.Montant_HT__c}" />
                                        </td>
                                        <td width="18%" style="text-align:center;">
                                            <apex:outputField value="{!paymentLigne.Montant_TVA__c}" />
                                        </td>
                                        <td width="18%" style="text-align:center;">
                                            <apex:outputField style="text-align:center;"
                                                value="{!paymentLigne.sofactoapp__Montant__c}" />
                                        </td>
                                    </tr>
                                </apex:outputPanel>
                            </apex:outputPanel>

                        </apex:repeat>
                    </apex:repeat>
                </table>
                
            
        </div>
    
    
    
    </div>
</div>
    <!--CGV/ Terms and Conditions-->

    <div style="page-break-before:always;">
        <apex:image value="{!URLFOR($Resource.Sofacto_CGV)}" style="left:0;top:0;width:98%"/>
    </div>
    <!--Fin code CGV/ End of terms and conditions-->

</apex:page>